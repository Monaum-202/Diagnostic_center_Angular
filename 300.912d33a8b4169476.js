"use strict";(self.webpackChunkhospital=self.webpackChunkhospital||[]).push([[300],{300:(E,f,u)=>{u.r(f),u.d(f,{LabEntryModule:()=>J});var m=u(6895),d=u(1960),g=u(3315),r=u(433),t=u(1571),p=u(529);function _(n,o){if(1&n){const a=t.EpF();t.TgZ(0,"li",22),t.NdJ("click",function(){const s=t.CHM(a).$implicit,l=t.oxw(2);return t.KtG(l.selectDoctor(s))}),t._uU(1),t.qZA()}if(2&n){const a=o.$implicit;t.xp6(1),t.hij(" ",a.name," ")}}function Z(n,o){if(1&n&&(t.TgZ(0,"ul",20),t.YNc(1,_,2,1,"li",21),t.qZA()),2&n){const a=t.oxw();t.xp6(1),t.Q6J("ngForOf",a.filteredDoctors)}}function A(n,o){if(1&n){const a=t.EpF();t.TgZ(0,"li",22),t.NdJ("click",function(){const s=t.CHM(a).$implicit,l=t.oxw(2);return t.KtG(l.selectTest(s))}),t._uU(1),t.qZA()}if(2&n){const a=o.$implicit;t.xp6(1),t.hij(" ",a.name," ")}}function T(n,o){if(1&n&&(t.TgZ(0,"ul",20),t.YNc(1,A,2,1,"li",21),t.qZA()),2&n){const a=t.oxw();t.xp6(1),t.Q6J("ngForOf",a.filteredTests)}}function b(n,o){if(1&n){const a=t.EpF();t.TgZ(0,"tr",34)(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td")(6,"button",35),t.NdJ("click",function(){const s=t.CHM(a).index,l=t.oxw(2);return t.KtG(l.removeTest(s))}),t._uU(7,"Remove"),t.qZA()()()}if(2&n){const a=o.$implicit;t.Q6J("formGroupName",o.index),t.xp6(2),t.Oqu(a.value.name),t.xp6(2),t.Oqu(a.value.price)}}function y(n,o){if(1&n){const a=t.EpF();t.TgZ(0,"div",23)(1,"h4"),t._uU(2,"Selected Tests"),t.qZA(),t.TgZ(3,"table",24)(4,"thead")(5,"tr")(6,"th"),t._uU(7,"Test Name"),t.qZA(),t.TgZ(8,"th"),t._uU(9,"Price"),t.qZA(),t.TgZ(10,"th"),t._uU(11,"Actions"),t.qZA()()(),t.TgZ(12,"tbody"),t.YNc(13,b,8,3,"tr",25),t.qZA()(),t.TgZ(14,"div",4)(15,"label"),t._uU(16,"Total Amount"),t.qZA(),t._UZ(17,"input",26),t.qZA(),t.TgZ(18,"div",4)(19,"label"),t._uU(20,"Discount (%)"),t.qZA(),t.TgZ(21,"input",27),t.NdJ("input",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.calculateAmounts())}),t.qZA()(),t.TgZ(22,"div",4)(23,"label"),t._uU(24,"Discount (Cash)"),t.qZA(),t.TgZ(25,"input",28),t.NdJ("input",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.calculateAmounts())}),t.qZA()(),t.TgZ(26,"div",4)(27,"label"),t._uU(28,"Payable Amount"),t.qZA(),t._UZ(29,"input",29),t.qZA(),t.TgZ(30,"div",4)(31,"label"),t._uU(32,"Paid Amount"),t.qZA(),t.TgZ(33,"input",30),t.NdJ("input",function(){t.CHM(a);const i=t.oxw();return t.KtG(i.calculateAmounts())}),t.qZA()(),t.TgZ(34,"div",4)(35,"label"),t._uU(36,"Due Amount"),t.qZA(),t._UZ(37,"input",31),t.qZA(),t._UZ(38,"input",32),t.TgZ(39,"button",33),t._uU(40,"Submit"),t.qZA()()}if(2&n){const a=t.oxw();t.xp6(13),t.Q6J("ngForOf",a.diagonesticTests.controls),t.xp6(25),t.Q6J("value",a.userName)}}let q=(()=>{const o=class{constructor(e,i,s){this.http=e,this.route=i,this.fb=s,this.selectedBranch="",this.testNameControl=new r.NI(""),this.doctorNameControl=new r.NI(""),this.tests=[],this.filteredTests=[],this.doctors=[],this.filteredDoctors=[],this.totalAmount=0,this.discountPercent=0,this.discountCash=0,this.payableAmount=0,this.paidAmount=0,this.dueAmount=0,this.userlist=[],this.userName="",this.format="pdf",this.id="",this.toDate="";const l=sessionStorage.getItem("auth-user");this.userName=l?JSON.parse(l).user.userName:"Guest",console.log("Retrieved userName:",this.userName),console.log(this.userName)}ngOnInit(){this.initializeForm(),this.fetchTests(),this.fetchDoctors()}initializeForm(){this.reactform=this.fb.group({id:new r.NI(null),patientName:new r.NI("",r.kI.required),age:new r.NI("",r.kI.required),sex:new r.NI("",r.kI.required),mobile:new r.NI("",r.kI.required),createdBy:new r.NI(this.userName),totalAmount:new r.NI(0),discount:new r.NI(0),discount1:new r.NI(0),payableAmount:new r.NI(0),paidAmount:new r.NI(0),dueAmount:new r.NI(0),refBy:new r.NI(null),diagonesticTests:this.fb.array([])})}get diagonesticTests(){return this.reactform.get("diagonesticTests")}fetchTests(){this.http.get("http://localhost:9090/api/diagnostic").subscribe(e=>{this.tests=e||[]},e=>{console.error("Error fetching tests:",e),alert("Failed to load test data.")})}fetchDoctors(){this.http.get("http://localhost:9090/api/doctor").subscribe(e=>{this.doctors=e||[]},e=>{console.error("Error fetching doctors:",e),alert("Failed to load doctor data.")})}filterTests(){const e=this.testNameControl.value?.trim().toLowerCase()||"";this.filteredTests=e?this.tests.filter(i=>i.name.toLowerCase().includes(e)):[]}selectTest(e){this.diagonesticTests.controls.some(s=>s.value.id===e.id)?alert("Test is already added."):(this.diagonesticTests.push(this.fb.group({id:e.id,name:e.name,price:e.price})),this.calculateAmounts()),this.testNameControl.setValue(""),this.filteredTests=[]}removeTest(e){this.diagonesticTests.removeAt(e),this.calculateAmounts()}filterDoctors(){const e=this.doctorNameControl.value?.trim().toLowerCase()||"";this.filteredDoctors=e?this.doctors.filter(i=>i.name.toLowerCase().includes(e)):[]}selectDoctor(e){this.reactform.patchValue({refBy:e.id}),this.doctorNameControl.setValue(e.name),this.filteredDoctors=[]}calculateAmounts(){this.totalAmount=this.diagonesticTests.controls.reduce((s,l)=>s+l.value.price,0);const i=Math.min(this.totalAmount*this.reactform.value.discount/100+this.reactform.value.discount1,this.totalAmount);this.payableAmount=this.totalAmount-i,this.dueAmount=Math.max(this.payableAmount-this.reactform.value.paidAmount,0),this.reactform.patchValue({totalAmount:this.totalAmount,payableAmount:this.payableAmount,dueAmount:this.dueAmount})}submitForm(){this.reactform.valid?(console.log("Form submitted:",this.reactform.value),this.http.post("http://localhost:9090/api/MoneyReceipt",this.reactform.value).subscribe(e=>{e&&e.id?(console.log("Form submitted successfully",e),this.downloadReceipt(e.id),setTimeout(()=>{this.reactform.reset(),this.diagonesticTests.clear()},1e3)):alert("Form submitted, but no receipt ID returned.")},e=>{console.error("Error submitting form:",e),alert("Failed to submit form.")})):alert("Please fill out all required fields correctly.")}downloadReceipt(e){this.http.get(`http://localhost:9090/receipt/download?format=pdf&id=${e}`,{responseType:"blob"}).subscribe(s=>{const l=new Blob([s],{type:"application/pdf"}),c=window.URL.createObjectURL(l),h=window.open("","_blank");h?(h.document.write(`\n            <iframe src="${c}" style="width:100%;height:100%;" onload="this.contentWindow.print();"></iframe>\n          `),h.document.close()):alert("Popup blocked! Please allow popups for this site."),setTimeout(()=>window.URL.revokeObjectURL(c),5e3)},s=>{console.error("Error generating report:",s),alert("Failed to generate receipt.")})}};let n=o;return o.\u0275fac=function(i){return new(i||o)(t.Y36(p.eN),t.Y36(d.gz),t.Y36(r.qu))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-data-entry"]],decls:50,vars:6,consts:[[3,"formGroup","ngSubmit"],[1,"row"],[1,"col-md-6"],[1,"container"],[1,"form-group"],[1,"required"],["type","text","formControlName","patientName","placeholder","Enter Name",1,"form-control"],["type","text","formControlName","mobile","placeholder","Enter Phone",1,"form-control"],[1,"col-md-3"],["formControlName","sex",1,"form-control"],["value","Male"],["value","Female"],["value","Other"],["type","number","formControlName","age","placeholder","Enter age",1,"form-control"],["for","doctorName"],["type","text","id","doctorName","placeholder","Type doctor name",1,"form-control",3,"formControl","input"],["class","autocomplete-list",4,"ngIf"],["for","testName"],["type","text","id","testName","placeholder","Type test name",1,"form-control",3,"formControl","input"],["class","mt-4",4,"ngIf"],[1,"autocomplete-list"],["class","autocomplete-item",3,"click",4,"ngFor","ngForOf"],[1,"autocomplete-item",3,"click"],[1,"mt-4"],[1,"table","table-bordered"],[3,"formGroupName",4,"ngFor","ngForOf"],["type","number","formControlName","totalAmount","readonly","",1,"form-control","totalAmount"],["type","number","formControlName","discount","placeholder","Enter Discount %","min","0",1,"form-control","discount",3,"input"],["type","number","formControlName","discount1","placeholder","Enter Discount Amount","min","0",1,"form-control","discountToRound",3,"input"],["type","number","formControlName","payableAmount","readonly","",1,"form-control","payableAmount"],["type","number","formControlName","paidAmount","placeholder","Enter Paid Amount","min","0",1,"form-control","paidAmount",3,"input"],["type","number","formControlName","dueAmount","readonly","",1,"form-control","dueAmount"],["type","text","formControlName","createdBy","hidden","",3,"value"],["type","submit",1,"btn","btn-primary"],[3,"formGroupName"],[3,"click"]],template:function(i,s){1&i&&(t.TgZ(0,"form",0),t.NdJ("ngSubmit",function(){return s.submitForm()}),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"label"),t._uU(6,"Patient Name "),t.TgZ(7,"span",5),t._uU(8,"*"),t.qZA()(),t._UZ(9,"input",6),t.qZA(),t.TgZ(10,"div",1)(11,"div",2)(12,"div",4)(13,"label"),t._uU(14,"Phone Number "),t.TgZ(15,"span",5),t._uU(16,"*"),t.qZA()(),t._UZ(17,"input",7),t.qZA()(),t.TgZ(18,"div",8)(19,"div",4)(20,"label"),t._uU(21,"Gender"),t.qZA(),t.TgZ(22,"select",9)(23,"option",10),t._uU(24,"Male"),t.qZA(),t.TgZ(25,"option",11),t._uU(26,"Female"),t.qZA(),t.TgZ(27,"option",12),t._uU(28,"Other"),t.qZA()()()(),t.TgZ(29,"div",8)(30,"div",4)(31,"label"),t._uU(32,"Age"),t.qZA(),t._UZ(33,"input",13),t.qZA()()(),t.TgZ(34,"div",4)(35,"label",14),t._uU(36,"Referral Doctor "),t.TgZ(37,"span",5),t._uU(38,"*"),t.qZA()(),t.TgZ(39,"input",15),t.NdJ("input",function(){return s.filterDoctors()}),t.qZA(),t.YNc(40,Z,2,1,"ul",16),t.qZA(),t.TgZ(41,"div",4)(42,"label",17),t._uU(43,"Test Name "),t.TgZ(44,"span",5),t._uU(45,"*"),t.qZA()(),t.TgZ(46,"input",18),t.NdJ("input",function(){return s.filterTests()}),t.qZA(),t.YNc(47,T,2,1,"ul",16),t.qZA()()(),t.TgZ(48,"div",2),t.YNc(49,y,41,2,"div",19),t.qZA()()()),2&i&&(t.Q6J("formGroup",s.reactform),t.xp6(39),t.Q6J("formControl",s.doctorNameControl),t.xp6(1),t.Q6J("ngIf",s.filteredDoctors.length>0),t.xp6(6),t.Q6J("formControl",s.testNameControl),t.xp6(1),t.Q6J("ngIf",s.filteredTests.length>0),t.xp6(2),t.Q6J("ngIf",s.diagonesticTests.controls.length>=0))},dependencies:[m.sg,m.O5,r._Y,r.YN,r.Kr,r.Fj,r.wV,r.EJ,r.JJ,r.JL,r.qQ,r.oH,r.sg,r.u,r.x0]}),n})();function N(n,o){if(1&n&&(t.TgZ(0,"option",14),t._uU(1),t.qZA()),2&n){const a=o.$implicit;t.Q6J("value",a),t.xp6(1),t.Oqu(a)}}let U=(()=>{const o=class{constructor(e,i){this.fb=e,this.http=i,this.exportFormats=["PDF","Excel","Excel Data Only"],this.selectedFormat="PDF",this.format="pdf",this.fromDate="",this.toDate=""}clearForm(){}generateReport(){}downloadFile(){const e=(new p.LE).set("format",this.format).set("formDate",this.fromDate).set("toDate",this.toDate);this.http.get("http://localhost:9090/download",{params:e,responseType:"blob"}).subscribe(i=>{const s=document.createElement("a"),l=window.URL.createObjectURL(i);s.href=l,s.download=`report.${this.format}`,s.click(),window.URL.revokeObjectURL(l)},i=>{console.error("Download failed",i)})}};let n=o;return o.\u0275fac=function(i){return new(i||o)(t.Y36(r.qu),t.Y36(p.eN))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-sales-report"]],decls:22,vars:5,consts:[[1,"container","mt-4"],[1,"card","p-3"],[1,"row","g-3"],["for","fromDate"],["type","datetime-local","id","fromDate","name","fromDate",3,"ngModel","ngModelChange"],["for","toDate"],["type","datetime-local","id","toDate","name","toDate",3,"ngModel","ngModelChange"],[1,"col-md-3","d-flex","align-items-end"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"d-flex","justify-content-end","mt-3"],[1,"form-select","w-auto","me-2",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["target","_blank",3,"href"],["type","button",1,"btn-submit"],[3,"value"]],template:function(i,s){1&i&&(t.TgZ(0,"div",0)(1,"h4"),t._uU(2,"Sales Summary"),t.qZA(),t.TgZ(3,"div",1)(4,"form",2)(5,"div")(6,"label",3),t._uU(7,"From Date:"),t.qZA(),t.TgZ(8,"input",4),t.NdJ("ngModelChange",function(c){return s.fromDate=c}),t.qZA()(),t.TgZ(9,"div")(10,"label",5),t._uU(11,"To Date:"),t.qZA(),t.TgZ(12,"input",6),t.NdJ("ngModelChange",function(c){return s.toDate=c}),t.qZA()(),t.TgZ(13,"div",7)(14,"button",8),t.NdJ("click",function(){return s.clearForm()}),t._uU(15,"Clear"),t.qZA()()()(),t.TgZ(16,"div",9)(17,"select",10),t.NdJ("ngModelChange",function(c){return s.selectedFormat=c}),t.YNc(18,N,2,2,"option",11),t.qZA(),t.TgZ(19,"a",12)(20,"button",13),t._uU(21,"Print"),t.qZA()()()()),2&i&&(t.xp6(8),t.Q6J("ngModel",s.fromDate),t.xp6(4),t.Q6J("ngModel",s.toDate),t.xp6(5),t.Q6J("ngModel",s.selectedFormat),t.xp6(1),t.Q6J("ngForOf",s.exportFormats),t.xp6(1),t.Q6J("href","http://localhost:9090/download?format="+s.format+"&fromDate="+s.fromDate+"&toDate="+s.toDate,t.LSH))},dependencies:[m.sg,r._Y,r.YN,r.Kr,r.Fj,r.EJ,r.JJ,r.JL,r.On,r.F]}),n})(),C=(()=>{const o=class{constructor(e){this.httpClient=e,this.apiUrl="http://localhost:9090/api/MoneyReceipt"}addData(e){return this.httpClient.post(this.apiUrl,e)}getAll(){return this.httpClient.get(this.apiUrl)}deleteById(e){return this.httpClient.delete(this.apiUrl+"/"+e)}getById(e){return this.httpClient.get(this.apiUrl+"/"+e)}updateData(e){return console.log(e),this.httpClient.put(this.apiUrl+"/"+e.id,e)}};let n=o;return o.\u0275fac=function(i){return new(i||o)(t.LFG(p.eN))},o.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),n})();function v(n,o){if(1&n&&(t.TgZ(0,"tr")(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.qZA(),t.TgZ(5,"td"),t._uU(6),t.qZA(),t.TgZ(7,"td"),t._uU(8),t.qZA(),t.TgZ(9,"td"),t._uU(10),t.qZA(),t.TgZ(11,"td"),t._uU(12),t.qZA(),t.TgZ(13,"td"),t._uU(14),t.ALo(15,"date"),t.qZA(),t.TgZ(16,"td"),t._uU(17),t.qZA(),t.TgZ(18,"td"),t._uU(19),t.qZA(),t.TgZ(20,"td"),t._uU(21),t.qZA(),t.TgZ(22,"td"),t._uU(23),t.qZA(),t.TgZ(24,"td"),t._uU(25),t.qZA()()),2&n){const a=o.$implicit,e=o.index;t.xp6(2),t.Oqu(e+1),t.xp6(2),t.Oqu(a.id),t.xp6(2),t.Oqu(a.patientName),t.xp6(2),t.Oqu(a.mobile),t.xp6(2),t.Oqu(a.age),t.xp6(2),t.Oqu(a.sex),t.xp6(2),t.Oqu(t.xi3(15,12,a.createdAt,"dd-MMM-yyyy")),t.xp6(3),t.Oqu(a.payableAmount),t.xp6(2),t.Oqu(a.discount),t.xp6(2),t.Oqu(a.payableAmount-a.discount),t.xp6(2),t.Oqu(a.paidAmount),t.xp6(2),t.Oqu(a.payableAmount-a.discount-a.paidAmount)}}function D(n,o){1&n&&(t.TgZ(0,"tr")(1,"td",5),t._uU(2,"No patients found."),t.qZA()())}const w=[{path:"",redirectTo:"Data_Entry",pathMatch:"full"},{path:"LabEntry_dashboard",component:g.E},{path:"Data_Entry",component:q},{path:"sales_report",component:U},{path:"patient_list",component:(()=>{const o=class{constructor(e){this.diagnosisMoneyService=e,this.patients=[],this.filteredEmployee=null}ngOnInit(){this.getAllPatient()}getAllPatient(){this.subscription=this.diagnosisMoneyService.getAll().subscribe({next:e=>{console.log("Fetched Patients:",e),this.patients=e},error:e=>{console.error("Error fetching patients:",e)}})}deletePatient(e){this.diagnosisMoneyService.deleteById(e).subscribe({next:()=>{console.log("Patient deleted successfully"),this.getAllPatient()},error:i=>{console.error("Error deleting patient:",i)}})}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}};let n=o;return o.\u0275fac=function(i){return new(i||o)(t.Y36(C))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-patient-list"]],decls:31,vars:2,consts:[[1,"table","table-striped","table-bordered"],[1,"table-dark"],["scope","col"],[4,"ngFor","ngForOf"],[4,"ngIf"],["colspan","9",1,"text-center","text-muted"]],template:function(i,s){1&i&&(t._UZ(0,"br"),t.TgZ(1,"table",0)(2,"thead",1)(3,"tr")(4,"th",2),t._uU(5,"Sl No."),t.qZA(),t.TgZ(6,"th",2),t._uU(7,"ID"),t.qZA(),t.TgZ(8,"th",2),t._uU(9,"Patient Name"),t.qZA(),t.TgZ(10,"th",2),t._uU(11,"Phone Number"),t.qZA(),t.TgZ(12,"th",2),t._uU(13,"Age"),t.qZA(),t.TgZ(14,"th",2),t._uU(15,"Sex"),t.qZA(),t.TgZ(16,"th",2),t._uU(17,"Appointment Date"),t.qZA(),t.TgZ(18,"th",2),t._uU(19,"Total Amount"),t.qZA(),t.TgZ(20,"th",2),t._uU(21,"Discount"),t.qZA(),t.TgZ(22,"th",2),t._uU(23,"Payable Amount"),t.qZA(),t.TgZ(24,"th",2),t._uU(25,"Paid Amount"),t.qZA(),t.TgZ(26,"th",2),t._uU(27,"Due Amount"),t.qZA()()(),t.TgZ(28,"tbody"),t.YNc(29,v,26,15,"tr",3),t.YNc(30,D,3,0,"tr",4),t.qZA()()),2&i&&(t.xp6(29),t.Q6J("ngForOf",s.patients),t.xp6(1),t.Q6J("ngIf",0===s.patients.length))},dependencies:[m.sg,m.O5,m.uU]}),n})()}];let F=(()=>{const o=class{};let n=o;return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.Bz.forChild(w),d.Bz]}),n})(),J=(()=>{const o=class{};let n=o;return o.\u0275fac=function(i){return new(i||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[m.ez,F,p.JF,r.u5,r.UX,d.Bz]}),n})()}}]);